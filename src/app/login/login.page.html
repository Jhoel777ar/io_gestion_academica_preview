<ion-header>
  <ion-toolbar>
    <ion-title>Login</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="login-content">
  <div class="login-container">

    <!-- Header -->
    <div class="header-section">
      <ion-icon name="school-outline" class="main-icon"></ion-icon>
      <h1>Gestión Académica</h1>
      <p class="subtitle">Tu compañero de estudios digital</p>
    </div>

    <!-- Mode Toggle -->
    <ion-segment [(ngModel)]="isLoginMode" class="mode-segment">
      <ion-segment-button [value]="true">
        <ion-label>Ingresar</ion-label>
      </ion-segment-button>
      <ion-segment-button [value]="false">
        <ion-label>Registrarse</ion-label>
      </ion-segment-button>
    </ion-segment>

    <!-- LOGIN FORM -->
    <form *ngIf="isLoginMode" [formGroup]="loginForm" (ngSubmit)="onLogin()">
      <ion-item>
        <ion-icon name="mail-outline" slot="start"></ion-icon>
        <ion-input formControlName="email" type="email" inputmode="email" placeholder="Correo electrónico"></ion-input>
      </ion-item>
      <div *ngIf="emailError"><ion-text color="danger">Email inválido</ion-text></div>

      <ion-item>
        <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
        <ion-input formControlName="password" [type]="showPassword ? 'text' : 'password'"
          placeholder="Contraseña"></ion-input>
        <ion-button slot="end" fill="clear" (click)="togglePasswordVisibility()">
          <ion-icon [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
        </ion-button>
      </ion-item>
      <div *ngIf="passwordError"><ion-text color="danger">Contraseña mínima 6 caracteres</ion-text></div>

      <ion-item lines="none">
        <ion-checkbox formControlName="rememberMe" slot="start"></ion-checkbox>
        <ion-label>Recordarme</ion-label>
      </ion-item>

      <ion-button expand="block" type="submit" [disabled]="!loginForm.valid">Ingresar</ion-button>
      <ion-button expand="block" fill="clear" (click)="forgotPassword()">¿Olvidaste tu contraseña?</ion-button>
    </form>

    <!-- REGISTER FORM -->
    <form *ngIf="!isLoginMode" [formGroup]="registerForm" (ngSubmit)="onRegister()">
      <ion-item>
        <ion-icon name="mail-outline" slot="start"></ion-icon>
        <ion-input formControlName="email" type="email" inputmode="email" placeholder="Correo electrónico"></ion-input>
      </ion-item>
      <div *ngIf="regEmailError"><ion-text color="danger">Email inválido</ion-text></div>

      <ion-item>
        <ion-icon name="person-outline" slot="start"></ion-icon>
        <ion-input formControlName="nombre" placeholder="Nombre completo"></ion-input>
      </ion-item>

      <ion-item>
        <ion-icon name="school-outline" slot="start"></ion-icon>
        <ion-input formControlName="universidad" placeholder="Universidad"></ion-input>
      </ion-item>

      <ion-item>
        <ion-icon name="library-outline" slot="start"></ion-icon>
        <ion-input formControlName="carrera" placeholder="Carrera"></ion-input>
      </ion-item>

      <ion-item>
        <ion-icon name="calendar-outline" slot="start"></ion-icon>
        <ion-input formControlName="semestre" type="number" inputmode="numeric" placeholder="Semestre"></ion-input>
      </ion-item>

      <!-- ROLE SELECT -->
      <ion-item>
        <div slot="start"><ion-icon name="people-outline"></ion-icon></div>
        <ion-label>Registrarme como</ion-label>
        <ion-select formControlName="role" placeholder="Selecciona rol">
          <ion-select-option value="estudiante">Estudiante</ion-select-option>
          <ion-select-option value="docente">Docente</ion-select-option>
        </ion-select>
      </ion-item>
      <div *ngIf="registerForm.get('role')?.invalid && registerForm.get('role')?.touched">
        <ion-text color="danger">Selecciona un rol</ion-text>
      </div>

      <ion-item>
        <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
        <ion-input formControlName="password" [type]="showPassword ? 'text' : 'password'"
          placeholder="Contraseña"></ion-input>
      </ion-item>

      <ion-item>
        <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
        <ion-input formControlName="confirmPassword" [type]="showPassword ? 'text' : 'password'"
          placeholder="Confirmar contraseña"></ion-input>
        <ion-button slot="end" fill="clear" (click)="togglePasswordVisibility()">
          <ion-icon [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
        </ion-button>
      </ion-item>
      <div *ngIf="passwordMismatch"><ion-text color="danger">Las contraseñas no coinciden</ion-text></div>

      <ion-item lines="none">
        <ion-checkbox formControlName="acceptTerms" slot="start"></ion-checkbox>
        <ion-label>Acepto términos y condiciones</ion-label>
      </ion-item>

      <ion-button expand="block" type="submit" [disabled]="!registerForm.valid">Crear Cuenta</ion-button>
    </form>

  </div>
</ion-content>